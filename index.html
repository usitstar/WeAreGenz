<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>WeAreGenZ - Page ƒê∆∞·ª£c Code By KhanhDepTRy</title>
    <style>
        /* Reset c∆° b·∫£n */
        * {
            box-sizing: border-box;
        }
        body, html {
            margin: 0; padding: 0;
            height: 100%;
            font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
            color: white;
            overflow: hidden;
            background: black;
        }
        #galaxy {
            position: fixed;
            top: 0; left: 0;
            width: 100vw;
            height: 100vh;
            z-index: 0;
            display: block;
        }
        .app-container {
            position: relative;
            z-index: 10;
            height: 100vh;
            width: 100vw;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 0 1rem;
            text-align: center;
        }
        h1 {
            font-size: 4rem;
            margin: 0;
            text-shadow: 0 0 10px #00ffff, 0 0 20px #00ffff, 0 0 30px #00ffff, 0 0 40px #00ffff, 0 0 70px #00ffff;
        }
        .subtitle {
            font-size: 1.2rem;
            margin-top: 0.2rem;
            font-style: italic;
            color: #a0ffffcc;
            text-shadow: 0 0 5px #00ffff88;
        }
        .days-count {
            margin-top: 2rem;
            font-size: 2.5rem;
            color: #7fffd4;
            text-shadow: 0 0 7px #00ffffaa;
        }
        .btn {
            margin-top: 2rem;
            background: #00ffffcc;
            border: none;
            border-radius: 8px;
            color: black;
            font-weight: 700;
            font-size: 1rem;
            padding: 0.6rem 1.4rem;
            cursor: pointer;
            box-shadow: 0 0 10px #00ffff99;
            transition: background-color 0.3s ease;
        }
        .btn:hover, .btn:focus {
            background: #00ffffee;
            outline: none;
        }
        /* N√∫t Ng√¥n Ng·ªØ g√≥c tr√™n ph·∫£i */
        #langBtn {
            position: fixed;
            top: 1rem;
            right: 1rem;
            background: #00ffffaa;
            border: none;
            padding: 0.4rem 0.8rem;
            font-size: 0.9rem;
            border-radius: 5px;
            cursor: pointer;
            z-index: 20;
            color: black;
            font-weight: 600;
            box-shadow: 0 0 6px #00ffffcc;
            transition: background-color 0.3s ease;
        }
        #langBtn:hover, #langBtn:focus {
            background: #00ffffee;
            outline: none;
        }
        /* N√∫t Ch∆°i X-O g√≥c tr√™n tr√°i (b√™n d∆∞·ªõi n√∫t nh·∫°c) */
        #ticTacToeBtn {
            position: fixed;
            top: 1rem; /* ƒêi·ªÅu ch·ªânh v·ªã tr√≠ ƒë·ªÉ kh√¥ng b·ªã ch·ªìng l√™n n√∫t nh·∫°c */
            left: 1rem;
            background: #00ffffaa;
            border: none;
            padding: 0.4rem 0.8rem;
            font-size: 0.9rem;
            border-radius: 5px;
            cursor: pointer;
            z-index: 20;
            color: black;
            font-weight: 600;
            box-shadow: 0 0 6px #00ffffcc;
            transition: background-color 0.3s ease;
        }
        #ticTacToeBtn:hover, #ticTacToeBtn:focus {
            background: #00ffffee;
            outline: none;
        }
        /* Modal chung */
        .modal-overlay {
            position: fixed;
            top: 0; left: 0;
            width: 100vw;
            height: 100vh;
            background: rgba(0, 0, 0, 0.85);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 100;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.35s ease;
        }
        .modal-overlay.active {
            opacity: 1;
            pointer-events: auto;
        }
        .modal-content {
            background: #001f26;
            border-radius: 12px;
            padding: 1.5rem 2rem;
            max-width: 400px;
            width: 90%;
            position: relative;
            box-shadow: 0 0 15px #00ffffaa;
            transform: translateY(-20px);
            opacity: 0;
            transition: opacity 0.35s ease, transform 0.35s ease;
        }
        .modal-overlay.active .modal-content {
            transform: translateY(0);
            opacity: 1;
        }
        .modal-header {
            display: flex;
            justify-content: flex-end;
        }
        .close-btn {
            background: transparent;
            border: none;
            font-size: 1.6rem;
            font-weight: bold;
            cursor: pointer;
            color: #00ffffcc;
            transition: color 0.3s ease;
        }
        .close-btn:hover, .close-btn:focus {
            color: #00ffffee;
            outline: none;
        }
        /* List ng√¥n ng·ªØ */
        .lang-list {
            list-style: none;
            padding: 0;
            margin: 0;
            margin-top: 0.5rem;
        }
        .lang-list li {
            margin: 0.6rem 0;
        }
        .lang-list button {
            width: 100%;
            background: #004d66;
            border: none;
            border-radius: 8px;
            color: #00ffffcc;
            font-weight: 700;
            padding: 0.6rem 1rem;
            cursor: pointer;
            font-size: 1rem;
            box-shadow: 0 0 7px #00ffff88;
            transition: background-color 0.3s ease;
        }
        .lang-list button:hover, .lang-list button:focus {
            background: #007a99;
            outline: none;
        }
        /* Input ng√†y b·∫Øt ƒë·∫ßu */
        label {
            display: block;
            margin-bottom: 0.4rem;
            font-weight: 600;
            color: #00ffffcc;
        }
        input[type="date"] {
            width: 100%;
            padding: 0.4rem 0.6rem;
            border-radius: 8px;
            border: 2px solid #00ffffcc;
            background: #003344;
            color: white;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }
        input[type="date"]:focus {
            outline: none;
            border-color: #00ffffee;
        }
        input[type="date"].invalid {
            border-color: #ff4444;
            background: #330000;
        }
        .error-msg {
            color: #ff4444;
            font-size: 0.9rem;
            margin-top: 0.3rem;
        }

        /* --- CSS cho Game X-O --- */
        #ticTacToeModal .modal-content {
            background: #001a1f; /* N·ªÅn t·ªëi h∆°n cho game */
            max-width: 500px; /* TƒÉng k√≠ch th∆∞·ªõc modal cho game */
            padding: 1.5rem; /* Gi·∫£m padding m·ªôt ch√∫t ƒë·ªÉ v·ª´a v·∫∑t h∆°n */
            display: flex;
            flex-direction: column;
            align-items: center;
            overflow: visible; /* Cho ph√©p hoa hi·ªÉn th·ªã ngo√†i modal-content nh∆∞ng trong modal-overlay */
        }
        #gameArea {
            position: relative; /* Quan tr·ªçng cho vi·ªác ƒë·ªãnh v·ªã hoa */
            display: flex;
            flex-direction: column;
            align-items: center;
            width: fit-content; /* ƒêi·ªÅu ch·ªânh width ƒë·ªÉ bao quanh b·∫£ng */
            padding: 10px; /* T·∫°o kh√¥ng gian cho hoa */
        }
        #ticTacToeGame {
            display: grid;
            grid-template-columns: repeat(3, 100px);
            grid-template-rows: repeat(3, 100px);
            gap: 5px;
            margin-top: 20px;
            background-color: #00ffff33; /* ƒê∆∞·ªùng k·∫ª b·∫£ng */
            padding: 5px;
            border-radius: 8px;
            width: fit-content; /* ƒê·∫£m b·∫£o b·∫£ng game kh√¥ng qu√° r·ªông */
            flex-shrink: 0; /* NgƒÉn b·∫£ng co l·∫°i */
            box-shadow: 0 0 20px rgba(0, 255, 255, 0.4);
            position: relative; /* Cho c√°c hi·ªáu ·ª©ng con */
        }
        .cell {
            width: 100px;
            height: 100px;
            background-color: #001f26; /* N·ªÅn √¥ */
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 3em;
            font-weight: bold;
            color: #00ffff;
            cursor: pointer;
            border-radius: 5px;
            transition: background-color 0.2s ease, transform 0.1s ease;
        }
        .cell:hover {
            background-color: #003344;
            transform: scale(1.02);
        }
        .cell.x {
            color: #ff4444; /* M√†u cho X */
        }
        .cell.o {
            color: #44eeff; /* M√†u cho O */
        }
        #gameStatus {
            margin-top: 1.5rem;
            font-size: 1.5rem;
            font-weight: bold;
            color: #00ffff;
            text-shadow: 0 0 5px #00ffff88;
        }
        #restartGameBtn {
            margin-top: 1rem;
            background: #00ffffcc;
            border: none;
            border-radius: 8px;
            color: black;
            font-weight: 700;
            font-size: 1rem;
            padding: 0.6rem 1.4rem;
            cursor: pointer;
            box-shadow: 0 0 10px #00ffff99;
            transition: background-color 0.3s ease;
        }
        #restartGameBtn:hover, #restartGameBtn:focus {
            background: #00ffffee;
            outline: none;
        }
        #gameStatsContainer {
            margin-top: 2rem;
            width: 90%;
            background: #002c33;
            border-radius: 10px;
            padding: 1rem;
            box-shadow: 0 0 10px rgba(0, 255, 255, 0.3);
            text-align: center;
        }
        #gameStatsContainer h3 {
            color: #00ffff;
            margin-top: 0;
            margin-bottom: 1rem;
            font-size: 1.3rem;
        }
        #gameStatsList {
            list-style: none;
            padding: 0;
            margin: 0;
            display: flex;
            justify-content: space-around;
            font-size: 1.1rem;
        }
        #gameStatsList li {
            padding: 0.5rem 0;
            color: #fff;
        }
        #gameStatsList li span {
            font-weight: bold;
            color: #7fffd4;
        }

        /* --- Flower Border Effect CSS --- */
        #flowerBorderContainer {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            overflow: hidden; /* ƒê·∫£m b·∫£o hoa kh√¥ng tr√†n qu√° xa kh·ªèi khung gameArea */
            z-index: 1; /* ƒê·∫∑t hoa ·ªü tr√™n b·∫£ng game nh∆∞ng d∆∞·ªõi n·ªôi dung kh√°c */
            display: none; /* M·∫∑c ƒë·ªãnh ·∫©n, ch·ªâ hi·ªÉn th·ªã khi game m·ªü */
            border-radius: 8px; /* Bo tr√≤n theo b·∫£ng game */
        }

        .flower-petal {
            position: absolute;
            width: var(--petal-size);
            height: var(--petal-size);
            background-size: contain; /* ƒêi·ªÅu ch·ªânh k√≠ch th∆∞·ªõc h√¨nh ·∫£nh ƒë·ªÉ v·ª´a v·ªõi ph·∫ßn t·ª≠ */
            background-repeat: no-repeat;
            background-position: center;
            opacity: 0.8;
            pointer-events: none;
            animation: fall var(--animation-duration) linear infinite,
                       sway var(--sway-duration) ease-in-out infinite alternate;
        }

        /* Keyframes cho hi·ªáu ·ª©ng r∆°i */
        @keyframes fall {
            0% {
                transform: translateY(var(--start-y)) translateX(var(--start-x)) rotateZ(var(--start-rot));
                opacity: 0.8;
            }
            100% {
                transform: translateY(var(--end-y)) translateX(var(--end-x)) rotateZ(var(--end-rot));
                opacity: 0;
            }
        }

        /* Keyframes cho hi·ªáu ·ª©ng l·∫Øc l∆∞ */
        @keyframes sway {
            0% {
                transform: rotate(0deg) translateX(0px);
            }
            50% {
                transform: rotate(var(--sway-rotation)) translateX(var(--sway-offset));
            }
            100% {
                transform: rotate(0deg) translateX(0px);
            }
        }

        /* Responsive cho game X-O */
        @media (max-width: 550px) {
            #ticTacToeGame {
                grid-template-columns: repeat(3, 80px);
                grid-template-rows: repeat(3, 80px);
            }
            .cell {
                width: 80px;
                height: 80px;
                font-size: 2.5em;
            }
            #ticTacToeModal .modal-content {
                max-width: 95%; /* TƒÉng ƒë·ªô r·ªông tr√™n di ƒë·ªông */
                padding: 1rem;
            }
            #gameStatus {
                font-size: 1.2rem;
            }
        }
    </style>
</head>
<body>

<canvas id="galaxy" aria-hidden="true"></canvas>

<button id="ticTacToeBtn" aria-label="Ch∆°i game X-O">üéÆ Ch∆°i X-O</button>

<button id="langBtn" aria-label="Ch·ªçn ng√¥n ng·ªØ">Ng√¥n Ng·ªØ</button>

<div class="app-container" role="main">
    <h1 id="title">WeAreGenZ</h1>
    <div class="subtitle" id="subtitle">Page ƒê∆∞·ª£c Code By KhanhDepTRy</div>
    <div class="days-count" id="daysCount" aria-live="polite">ƒêang t√≠nh s·ªë ng√†y s·ªëng m·ªôt m√¨nh...</div>
    <button class="btn" id="changeDateBtn" aria-label="Ch·ªçn l·∫°i ng√†y b·∫Øt ƒë·∫ßu">Ch·ªçn l·∫°i ng√†y b·∫Øt ƒë·∫ßu</button>
</div>

<div class="modal-overlay" id="langModal" role="dialog" aria-modal="true" aria-labelledby="langModalTitle" tabindex="-1" aria-hidden="true">
    <div class="modal-content">
        <div class="modal-header">
            <button class="close-btn" id="closeLangModal" aria-label="ƒê√≥ng c·ª≠a s·ªï ch·ªçn ng√¥n ng·ªØ">&times;</button>
        </div>
        <h2 id="langModalTitle" style="color:#00ffffcc; margin-top:0;">Ch·ªçn Ng√¥n Ng·ªØ / Choose Language / Ë®ÄË™û„ÇíÈÅ∏Êäû</h2>
        <ul class="lang-list">
            <li><button data-lang="vi" aria-label="Ch·ªçn ti·∫øng Vi·ªát">Ti·∫øng Vi·ªát</button></li>
            <li><button data-lang="en" aria-label="Select English">English</button></li>
            <li><button data-lang="jp" aria-label="Êó•Êú¨Ë™û„ÇíÈÅ∏Êäû">Êó•Êú¨Ë™û</button></li>
        </ul>
    </div>
</div>

<div class="modal-overlay" id="dateModal" role="dialog" aria-modal="true" aria-labelledby="dateModalTitle" tabindex="-1" aria-hidden="true">
    <div class="modal-content">
        <div class="modal-header">
            <button class="close-btn" id="closeDateModal" aria-label="ƒê√≥ng c·ª≠a s·ªï ch·ªçn ng√†y">&times;</button>
        </div>
        <h2 id="dateModalTitle" style="color:#00ffffcc; margin-top:0;">Ch·ªçn ng√†y b·∫Øt ƒë·∫ßu s·ªëng m·ªôt m√¨nh</h2>
        <form id="dateForm" novalidate>
            <label for="startDateInput" id="dateInputLabel">Ng√†y b·∫Øt ƒë·∫ßu:</label>
            <input type="date" id="startDateInput" aria-required="true" aria-describedby="errorMsg" />
            <div class="error-msg" id="errorMsg" role="alert" aria-live="assertive" style="display:none;">Ng√†y kh√¥ng h·ª£p l·ªá</div>
            <button type="submit" class="btn" aria-label="X√°c nh·∫≠n ng√†y b·∫Øt ƒë·∫ßu">X√°c nh·∫≠n</button>
        </form>
    </div>
</div>

<div class="modal-overlay" id="ticTacToeModal" role="dialog" aria-modal="true" aria-labelledby="ticTacToeTitle" tabindex="-1" aria-hidden="true">
    <div class="modal-content">
        <div class="modal-header">
            <button class="close-btn" id="closeTicTacToeModal" aria-label="ƒê√≥ng game X-O">&times;</button>
        </div>
        <h2 id="ticTacToeTitle" style="color:#00ffffcc; margin-top:0;">C·ªù Caro (Tic-Tac-Toe) - Ch∆°i v·ªõi TanamiChatbot</h2>

        <div id="gameArea">
            <div id="flowerBorderContainer"></div> 
            <div id="gameStatus"></div>
            <div id="ticTacToeGame">
                <div class="cell" data-cell-index="0"></div>
                <div class="cell" data-cell-index="1"></div>
                <div class="cell" data-cell-index="2"></div>
                <div class="cell" data-cell-index="3"></div>
                <div class="cell" data-cell-index="4"></div>
                <div class="cell" data-cell-index="5"></div>
                <div class="cell" data-cell-index="6"></div>
                <div class="cell" data-cell-index="7"></div>
                <div class="cell" data-cell-index="8"></div>
            </div>
            <button id="restartGameBtn"></button>
        </div>

        <div id="gameStatsContainer">
            <h3 id="gameStatsTitle"></h3>
            <ul id="gameStatsList">
                <li id="playerWins"></li>
                <li id="aiWins"></li>
                <li id="draws"></li>
            </ul>
        </div>
    </div>
</div>

<script>
    // =======================
    // N·ªÄN GALAXY m·ªõi (t·ª´ b·∫°n cung c·∫•p)
    // =======================
    const canvas = document.getElementById('galaxy');
    const ctx = canvas.getContext('2d');
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;

    window.addEventListener('resize', () => {
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
    });

    function randomColor() {
      const colors = ['#ffffff', '#8fd3f4', '#fbc2eb', '#f6d365', '#c3cfe2', '#f7797d', '#c2e9fb'];
      return colors[Math.floor(Math.random() * colors.length)];
    }

    // === Stars ===
    const stars = [];
    const numStars = 300;

    class Star {
      constructor() {
        this.reset();
      }

      reset() {
        this.x = Math.random() * canvas.width;
        this.y = Math.random() * canvas.height;
        this.z = Math.random() * canvas.width;
        this.radius = Math.random() * 1.2 + 0.2;
        this.color = randomColor();
      }

      draw() {
        let scale = canvas.width / (canvas.width + this.z);
        let x = this.x * scale;
        let y = this.y * scale;
        let r = this.radius * scale;

        ctx.beginPath();
        ctx.fillStyle = this.color;
        ctx.globalAlpha = 0.8;
        ctx.arc(x, y, r, 0, Math.PI * 2);
        ctx.fill();
        ctx.globalAlpha = 1;
      }

      update() {
        this.z -= 0.5;
        if (this.z <= 0) {
          this.reset();
          this.z = canvas.width;
        }
      }
    }

    for (let i = 0; i < numStars; i++) {
      stars.push(new Star());
    }

    // === Nebula (Tinh v√¢n b·ª•i) ===
    const nebulas = [];
    const nebulaCount = 10;

    class Nebula {
      constructor() {
        this.reset();
      }

      reset() {
        this.x = Math.random() * canvas.width;
        this.y = Math.random() * canvas.height;
        this.size = Math.random() * 300 + 100;
        this.color = randomColor();
        this.opacity = Math.random() * 0.1 + 0.05;
        this.vx = Math.random() * 0.2 - 0.1;
        this.vy = Math.random() * 0.2 - 0.1;
      }

      draw() {
        let gradient = ctx.createRadialGradient(this.x, this.y, 0, this.x, this.y, this.size);
        gradient.addColorStop(0, this.color + Math.floor(this.opacity * 255).toString(16).padStart(2, '0'));
        gradient.addColorStop(1, 'transparent');
        ctx.fillStyle = gradient;
        ctx.beginPath();
        ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
        ctx.fill();
      }

      update() {
        this.x += this.vx;
        this.y += this.vy;

        // N·∫øu bay ra kh·ªèi m√†n th√¨ reset l·∫°i
        if (this.x < -this.size || this.x > canvas.width + this.size ||
            this.y < -this.size || this.y > canvas.height + this.size) {
          this.reset();
        }
      }
    }

    for (let i = 0; i < nebulaCount; i++) {
      nebulas.push(new Nebula());
    }

    // === Main loop ===
    function animate() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      nebulas.forEach(n => { n.update(); n.draw(); });
      stars.forEach(s => { s.update(); s.draw(); });

      requestAnimationFrame(animate);
    }

    animate();

    // =======================
    // L∆∞u tr·ªØ & x·ª≠ l√Ω ng√¥n ng·ªØ
    // =======================
    const texts = {
        vi: {
            title: "WeAreGenZ",
            subtitle: "Page ƒê∆∞·ª£c Code By KhanhDepTRy",
            daysCountText: (n) => `B·∫°n ƒë√£ s·ªëng m·ªôt m√¨nh ƒë∆∞·ª£c ${n} ng√†y`,
            changeDateBtn: "Ch·ªçn l·∫°i ng√†y b·∫Øt ƒë·∫ßu",
            langBtn: "Ng√¥n Ng·ªØ",
            langModalTitle: "Ch·ªçn Ng√¥n Ng·ªØ",
            dateModalTitle: "Ch·ªçn ng√†y b·∫Øt ƒë·∫ßu s·ªëng m·ªôt m√¨nh",
            dateInputLabel: "Ng√†y b·∫Øt ƒë·∫ßu:",
            errorInvalidDate: "Ng√†y kh√¥ng h·ª£p l·ªá",
            confirmBtn: "X√°c nh·∫≠n",
            // Game X-O texts
            ticTacToeBtn: "üéÆ Ch∆°i X-O",
            ticTacToeTitle: "C·ªù Caro (Tic-Tac-Toe) - Ch∆°i v·ªõi TanamiChatbot",
            playerTurn: (player) => `L∆∞·ª£t c·ªßa ${player}`,
            playerWin: (player) => `${player} ƒë√£ th·∫Øng!`,
            draw: "H√≤a!",
            restartGame: "Ch∆°i L·∫°i",
            gameStatsTitle: "Th·ªëng K√™",
            playerWins: (count) => `B·∫°n th·∫Øng: ${count}`,
            aiWins: (count) => `TanamiChatbot th·∫Øng: ${count}`,
            draws: (count) => `H√≤a: ${count}`
        },
        en: {
            title: "WeAreGenZ",
            subtitle: "Page Coded By KhanhDepTRy",
            daysCountText: (n) => `You have been alone for ${n} days`,
            changeDateBtn: "Change Start Date",
            langBtn: "Language",
            langModalTitle: "Select Language",
            dateModalTitle: "Select start date living alone",
            dateInputLabel: "Start Date:",
            errorInvalidDate: "Invalid date",
            confirmBtn: "Confirm",
            // Game X-O texts
            ticTacToeBtn: "üéÆ Play X-O",
            ticTacToeTitle: "Tic-Tac-Toe - Play with TanamiChatbot",
            playerTurn: (player) => `${player}'s turn`,
            playerWin: (player) => `${player} Wins!`,
            draw: "Draw!",
            restartGame: "Play Again",
            gameStatsTitle: "Statistics",
            playerWins: (count) => `You Wins: ${count}`,
            aiWins: (count) => `TanamiChatbot Wins: ${count}`,
            draws: (count) => `Draws: ${count}`
        },
        jp: {
            title: "WeAreGenZ",
            subtitle: "„Ç≥„Éº„ÉâÔºöKhanhDepTRy",
            daysCountText: (n) => `„ÅÇ„Å™„Åü„ÅØ‰∏Ä‰∫∫„Åß ${n} Êó•ÈñìÊöÆ„Çâ„Åó„Å¶„ÅÑ„Åæ„Åô`,
            changeDateBtn: "ÈñãÂßãÊó•„ÇíÂ§âÊõ¥",
            langBtn: "Ë®ÄË™û",
            langModalTitle: "Ë®ÄË™û„ÇíÈÅ∏Êäû",
            dateModalTitle: "‰∏Ä‰∫∫ÊöÆ„Çâ„ÅóÈñãÂßãÊó•„ÇíÈÅ∏Êäû",
            dateInputLabel: "ÈñãÂßãÊó•:",
            errorInvalidDate: "ÁÑ°Âäπ„Å™Êó•‰ªò",
            confirmBtn: "Á¢∫Ë™ç",
            // Game X-O texts
            ticTacToeBtn: "üéÆ „Éû„É´„Éê„ÉÑ",
            ticTacToeTitle: "„Åæ„Çã„Å∞„Å§„Ç≤„Éº„É† - TanamiChatbot„Å®ÂØæÊà¶",
            playerTurn: (player) => `${player}„ÅÆ„Çø„Éº„É≥`,
            playerWin: (player) => `${player}„ÅÆÂãù„Å°ÔºÅ`,
            draw: "Âºï„ÅçÂàÜ„ÅëÔºÅ",
            restartGame: "„ÇÇ„ÅÜ‰∏ÄÂ∫¶ÈÅä„Å∂",
            gameStatsTitle: "Áµ±Ë®à",
            playerWins: (count) => `„ÅÇ„Å™„Åü„ÅÆÂãù„Å°: ${count}`,
            aiWins: (count) => `TanamiChatbot„ÅÆÂãù„Å°: ${count}`,
            draws: (count) => `Âºï„ÅçÂàÜ„Åë: ${count}`
        }
    };

    function getLang() {
        const lang = localStorage.getItem('waGenZ_lang');
        if (lang && ['vi', 'en', 'jp'].includes(lang)) return lang;
        return 'vi';
    }

    function setLang(l) {
        localStorage.setItem('waGenZ_lang', l);
    }

    // =======================
    // C·∫≠p nh·∫≠t n·ªôi dung theo ng√¥n ng·ªØ
    // =======================
    function updateTexts() {
        const lang = getLang();
        const t = texts[lang];
        document.getElementById('title').textContent = t.title;
        document.getElementById('subtitle').textContent = t.subtitle;
        document.getElementById('changeDateBtn').textContent = t.changeDateBtn;
        document.getElementById('langBtn').textContent = t.langBtn;
        document.getElementById('langModalTitle').textContent = t.langModalTitle;
        document.getElementById('dateModalTitle').textContent = t.dateModalTitle;
        document.getElementById('dateInputLabel').textContent = t.dateInputLabel;
        document.getElementById('errorMsg').textContent = t.errorInvalidDate;
        document.querySelector('#dateForm button[type=submit]').textContent = t.confirmBtn;
        
        // Update Tic-Tac-Toe texts
        document.getElementById('ticTacToeBtn').textContent = t.ticTacToeBtn;
        document.getElementById('ticTacToeTitle').textContent = t.ticTacToeTitle;
        document.getElementById('restartGameBtn').textContent = t.restartGame;
        document.getElementById('gameStatsTitle').textContent = t.gameStatsTitle;

        // Update game status if game is active
        if (gameActive) {
            const playerName = lang === 'vi' ? "B·∫°n" : (lang === 'en' ? "You" : "„ÅÇ„Å™„Åü");
            gameStatus.textContent = t.playerTurn(currentPlayer === playerChar ? playerName : "TanamiChatbot");
        } else if (winner === playerChar) {
            const playerName = lang === 'vi' ? "B·∫°n" : (lang === 'en' ? "You" : "„ÅÇ„Å™„Åü");
            gameStatus.textContent = t.playerWin(playerName);
        } else if (winner === aiChar) {
            gameStatus.textContent = t.playerWin("TanamiChatbot");
        }
        else if (!gameActive && gameBoard.every(cell => cell !== '')) {
            gameStatus.textContent = t.draw;
        }

        renderGameStats(); // C·∫≠p nh·∫≠t th·ªëng k√™ v·ªõi ng√¥n ng·ªØ m·ªõi
    }

    // =======================
    // Modal x·ª≠ l√Ω - ƒë√≥ng m·ªü & trap focus
    // =======================
    function trapFocus(modal) {
        const focusableElements = modal.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])');
        if (focusableElements.length === 0) return;
        const firstEl = focusableElements[0];
        const lastEl = focusableElements[focusableElements.length - 1];

        function handleTab(e) {
            if (e.key === 'Tab') {
                if (e.shiftKey) { // shift+tab
                    if (document.activeElement === firstEl) {
                        e.preventDefault();
                        lastEl.focus();
                    }
                } else { // tab
                    if (document.activeElement === lastEl) {
                        e.preventDefault();
                        firstEl.focus();
                    }
                }
            }
            if (e.key === 'Escape') {
                closeModal(modal);
            }
        }
        modal.addEventListener('keydown', handleTab);
        return () => modal.removeEventListener('keydown', handleTab);
    }

    function openModal(modal) {
        modal.classList.add('active');
        modal.setAttribute('aria-hidden', 'false');
        // Focus trap
        const removeTrap = trapFocus(modal);
        // Focus n√∫t ƒë·∫ßu ti√™n trong modal
        const focusable = modal.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])');
        if (focusable.length) focusable[0].focus();
        return removeTrap;
    }

    function closeModal(modal) {
        modal.classList.remove('active');
        modal.setAttribute('aria-hidden', 'true');
        // G·ª° b·ªè focus trap n·∫øu c√≥
        const removeTrap = modal._removeTrap;
        if (removeTrap) {
            removeTrap();
            delete modal._removeTrap;
        }
    }

    // =======================
    // Logic t√≠nh ng√†y
    // =======================
    const daysCountElement = document.getElementById('daysCount');
    const startDateInput = document.getElementById('startDateInput');
    const dateForm = document.getElementById('dateForm');
    const errorMsg = document.getElementById('errorMsg');
    const changeDateBtn = document.getElementById('changeDateBtn');
    const dateModal = document.getElementById('dateModal');
    const closeDateModal = document.getElementById('closeDateModal');

    // Load ng√†y t·ª´ Local Storage
    function loadStartDate() {
        const storedDate = localStorage.getItem('startDate');
        if (storedDate) {
            startDateInput.value = storedDate;
            calculateAndDisplayDays(storedDate);
        } else {
            // N·∫øu ch∆∞a c√≥, m·ªü modal ch·ªçn ng√†y
            openModal(dateModal);
        }
    }

    // T√≠nh to√°n v√† hi·ªÉn th·ªã s·ªë ng√†y
    function calculateAndDisplayDays(dateString) {
        const startDate = new Date(dateString);
        const today = new Date();
        // ƒê·∫∑t gi·ªù v·ªÅ 00:00:00 ƒë·ªÉ t√≠nh to√°n ch√≠nh x√°c s·ªë ng√†y
        startDate.setHours(0, 0, 0, 0);
        today.setHours(0, 0, 0, 0);

        const diffTime = Math.abs(today.getTime() - startDate.getTime());
        const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
        
        const t = texts[getLang()];
        daysCountElement.textContent = t.daysCountText(diffDays);
    }

    // Validate v√† l∆∞u ng√†y
    dateForm.addEventListener('submit', function(e) {
        e.preventDefault();
        const selectedDate = startDateInput.value;
        if (!selectedDate) {
            startDateInput.classList.add('invalid');
            errorMsg.style.display = 'block';
            errorMsg.textContent = texts[getLang()].errorInvalidDate;
            return;
        }

        const dateObj = new Date(selectedDate);
        const today = new Date();
        today.setHours(0,0,0,0); // Reset time for accurate comparison

        if (dateObj > today) {
            startDateInput.classList.add('invalid');
            errorMsg.style.display = 'block';
            errorMsg.textContent = "Ng√†y kh√¥ng ƒë∆∞·ª£c l·ªõn h∆°n ng√†y hi·ªán t·∫°i!"; // Lu√¥n l√† ti·∫øng Vi·ªát cho l·ªói n√†y ƒë·ªÉ d·ªÖ hi·ªÉu
            return;
        }

        localStorage.setItem('startDate', selectedDate);
        calculateAndDisplayDays(selectedDate);
        startDateInput.classList.remove('invalid');
        errorMsg.style.display = 'none';
        closeModal(dateModal);
    });

    startDateInput.addEventListener('change', () => {
        startDateInput.classList.remove('invalid');
        errorMsg.style.display = 'none';
    });

    changeDateBtn.addEventListener('click', () => openModal(dateModal));
    closeDateModal.addEventListener('click', () => closeModal(dateModal));

    // =======================
    // X·ª≠ l√Ω chuy·ªÉn ƒë·ªïi ng√¥n ng·ªØ
    // =======================
    const langModal = document.getElementById('langModal');
    const langBtn = document.getElementById('langBtn');
    const closeLangModal = document.getElementById('closeLangModal');
    const langList = document.querySelector('.lang-list');

    langBtn.addEventListener('click', () => openModal(langModal));
    closeLangModal.addEventListener('click', () => closeModal(langModal));

    langList.addEventListener('click', (e) => {
        if (e.target.tagName === 'BUTTON') {
            const newLang = e.target.dataset.lang;
            if (newLang) {
                setLang(newLang);
                updateTexts();
                loadStartDate(); // C·∫≠p nh·∫≠t l·∫°i s·ªë ng√†y v·ªõi ng√¥n ng·ªØ m·ªõi
                closeModal(langModal);
            }
        }
    });

    // =======================
    // Game X-O (Tic-Tac-Toe) Logic
    // =======================
    const ticTacToeBtn = document.getElementById('ticTacToeBtn');
    const ticTacToeModal = document.getElementById('ticTacToeModal');
    const closeTicTacToeModal = document.getElementById('closeTicTacToeModal');
    const cells = document.querySelectorAll('.cell');
    const gameStatus = document.getElementById('gameStatus');
    const restartGameBtn = document.getElementById('restartGameBtn');
    const flowerBorderContainer = document.getElementById('flowerBorderContainer');

    let gameBoard = ['', '', '', '', '', '', '', '', ''];
    let currentPlayer = 'X'; // Player is X, AI is O
    let gameActive = true;
    let winner = null;

    // Game Stats
    let playerWins = parseInt(localStorage.getItem('ticTacToePlayerWins') || '0');
    let aiWins = parseInt(localStorage.getItem('ticTacToeAIWins') || '0');
    let draws = parseInt(localStorage.getItem('ticTacToeDraws') || '0');

    const playerChar = 'X';
    const aiChar = 'O';

    const winningConditions = [
        [0, 1, 2], [3, 4, 5], [6, 7, 8], // rows
        [0, 3, 6], [1, 4, 7], [2, 5, 8], // columns
        [0, 4, 8], [2, 4, 6]             // diagonals
    ];

    function renderGameStats() {
        const t = texts[getLang()];
        document.getElementById('playerWins').textContent = t.playerWins(playerWins);
        document.getElementById('aiWins').textContent = t.aiWins(aiWins);
        document.getElementById('draws').textContent = t.draws(draws);
    }

    function saveGameStats() {
        localStorage.setItem('ticTacToePlayerWins', playerWins);
        localStorage.setItem('ticTacToeAIWins', aiWins);
        localStorage.setItem('ticTacToeDraws', draws);
    }

    function handleCellPlayed(clickedCell, clickedCellIndex) {
        gameBoard[clickedCellIndex] = currentPlayer;
        clickedCell.textContent = currentPlayer;
        clickedCell.classList.add(currentPlayer.toLowerCase());
    }

    function handleResultValidation() {
        let roundWon = false;
        for (let i = 0; i < winningConditions.length; i++) {
            const winCondition = winningConditions[i];
            let a = gameBoard[winCondition[0]];
            let b = gameBoard[winCondition[1]];
            let c = gameBoard[winCondition[2]];

            if (a === '' || b === '' || c === '') {
                continue;
            }
            if (a === b && b === c) {
                roundWon = true;
                break;
            }
        }

        const t = texts[getLang()];
        const playerName = getLang() === 'vi' ? "B·∫°n" : (getLang() === 'en' ? "You" : "„ÅÇ„Å™„Åü");

        if (roundWon) {
            winner = currentPlayer;
            gameActive = false;
            if (currentPlayer === playerChar) {
                playerWins++;
                gameStatus.textContent = t.playerWin(playerName);
            } else {
                aiWins++;
                gameStatus.textContent = t.playerWin("TanamiChatbot");
            }
            saveGameStats();
            renderGameStats();
            return;
        }

        // Check for draw
        if (!gameBoard.includes('')) {
            gameActive = false;
            draws++;
            gameStatus.textContent = t.draw;
            saveGameStats();
            renderGameStats();
            winner = null; // Reset winner for draw
            return;
        }

        // Continue game
        currentPlayer = currentPlayer === playerChar ? aiChar : playerChar;
        gameStatus.textContent = t.playerTurn(currentPlayer === playerChar ? playerName : "TanamiChatbot");

        if (currentPlayer === aiChar && gameActive) {
            setTimeout(handleAIChoice, 700); // AI makes a move after a short delay
        }
    }

    function handleCellClick(e) {
        const clickedCell = e.target;
        const clickedCellIndex = parseInt(clickedCell.dataset.cellIndex);

        if (gameBoard[clickedCellIndex] !== '' || !gameActive || currentPlayer === aiChar) {
            return;
        }

        handleCellPlayed(clickedCell, clickedCellIndex);
        handleResultValidation();
    }

    function handleAIChoice() {
        const availableMoves = gameBoard
            .map((cell, index) => cell === '' ? index : null)
            .filter(index => index !== null);

        if (availableMoves.length > 0 && gameActive) {
            // Simple AI: prioritize winning, blocking, then random
            let bestMove = -1;

            // 1. Check for AI winning moves
            for (let i = 0; i < winningConditions.length; i++) {
                const move = availableMoves[i];
                gameBoard[move] = aiChar;
                if (checkWin(aiChar)) {
                    bestMove = move;
                    gameBoard[move] = ''; // undo
                    break;
                }
                gameBoard[move] = ''; // undo
            }

            // 2. Check for player blocking moves
            if (bestMove === -1) {
                for (let i = 0; i < availableMoves.length; i++) {
                    const move = availableMoves[i];
                    gameBoard[move] = playerChar;
                    if (checkWin(playerChar)) {
                        bestMove = move;
                        gameBoard[move] = ''; // undo
                        break;
                    }
                    gameBoard[move] = ''; // undo
                }
            }
            
            // 3. Take center if available
            if (bestMove === -1 && gameBoard[4] === '') {
                bestMove = 4;
            }

            // 4. Take a corner if available
            if (bestMove === -1) {
                const corners = [0, 2, 6, 8].filter(index => gameBoard[index] === '');
                if (corners.length > 0) {
                    bestMove = corners[Math.floor(Math.random() * corners.length)];
                }
            }

            // 5. Take any remaining available spot
            if (bestMove === -1) {
                bestMove = availableMoves[Math.floor(Math.random() * availableMoves.length)];
            }


            const cellToPlay = document.querySelector(`[data-cell-index="${bestMove}"]`);
            handleCellPlayed(cellToPlay, bestMove);
            handleResultValidation();
        }
    }

    function checkWin(player) {
        for (let i = 0; i < winningConditions.length; i++) {
            const winCondition = winningConditions[i];
            let a = gameBoard[winCondition[0]];
            let b = gameBoard[winCondition[1]];
            let c = gameBoard[winCondition[2]];

            if (a === player && b === player && c === player) {
                return true;
            }
        }
        return false;
    }

    function restartGame() {
        gameBoard = ['', '', '', '', '', '', '', '', ''];
        currentPlayer = 'X';
        gameActive = true;
        winner = null;
        const t = texts[getLang()];
        const playerName = getLang() === 'vi' ? "B·∫°n" : (getLang() === 'en' ? "You" : "„ÅÇ„Å™„Åü");
        gameStatus.textContent = t.playerTurn(playerName);
        cells.forEach(cell => {
            cell.textContent = '';
            cell.classList.remove('x', 'o');
        });
        removeFlowerPetals(); // X√≥a c√°nh hoa c≈© khi kh·ªüi ƒë·ªông l·∫°i
    }

    cells.forEach(cell => cell.addEventListener('click', handleCellClick));
    restartGameBtn.addEventListener('click', restartGame);

    // Initial render for game stats
    renderGameStats();

    ticTacToeBtn.addEventListener('click', () => {
        openModal(ticTacToeModal);
        restartGame(); // Reset game when opening the modal
        showFlowerBorder(); // Show flowers when game modal opens
    });
    closeTicTacToeModal.addEventListener('click', () => {
        closeModal(ticTacToeModal);
        hideFlowerBorder(); // Hide flowers when game modal closes
    });

    // =======================
    // Hi·ªáu ·ª©ng hoa r∆°i (cho game X-O)
    // =======================
    const flowerImages = [
        'https://i.imgur.com/vHq4D0O.png', // Hoa h·ªìng (c√≥ n·ªÅn trong su·ªët)
        'https://i.imgur.com/kS9ZkYc.png', // Hoa ƒë√†o 1 (c√≥ n·ªÅn trong su·ªët)
        'https://i.imgur.com/s6pLp9N.png'  // Hoa ƒë√†o 2 (c√≥ n·ªÅn trong su·ªët)
    ];

    let flowerInterval;
    let flowerElements = [];

    function createFlowerPetal() {
        const flowerEl = document.createElement('div');
        flowerEl.classList.add('flower-petal');

        const randomIndex = Math.floor(Math.random() * flowerImages.length);
        flowerEl.style.backgroundImage = `url('${flowerImages[randomIndex]}')`;

        const size = Math.random() * 30 + 20; // K√≠ch th∆∞·ªõc t·ª´ 20px ƒë·∫øn 50px
        flowerEl.style.setProperty('--petal-size', `${size}px`);

        const startX = Math.random() * 100; // V·ªã tr√≠ X ban ƒë·∫ßu (0% - 100% chi·ªÅu r·ªông container)
        const startY = -size; // B·∫Øt ƒë·∫ßu t·ª´ ph√≠a tr√™n container
        flowerEl.style.left = `${startX}%`;
        flowerEl.style.top = `${startY}px`;

        const animationDuration = Math.random() * 10 + 5; // Th·ªùi gian r∆°i t·ª´ 5s ƒë·∫øn 15s
        flowerEl.style.setProperty('--animation-duration', `${animationDuration}s`);

        const endY = `calc(100% + ${size}px)`; // K·∫øt th√∫c d∆∞·ªõi container
        const endX = startX + (Math.random() - 0.5) * 50; // L·ªách X ng·∫´u nhi√™n
        flowerEl.style.setProperty('--start-x', `${startX}%`);
        flowerEl.style.setProperty('--start-y', `${startY}px`);
        flowerEl.style.setProperty('--end-x', `${endX}%`);
        flowerEl.style.setProperty('--end-y', `${endY}`);

        const startRot = Math.random() * 360;
        const endRot = startRot + (Math.random() - 0.5) * 720; // Xoay ng·∫´u nhi√™n
        flowerEl.style.setProperty('--start-rot', `${startRot}deg`);
        flowerEl.style.setProperty('--end-rot', `${endRot}deg`);

        const swayDuration = Math.random() * 4 + 2; // Th·ªùi gian l·∫Øc l∆∞ t·ª´ 2s ƒë·∫øn 6s
        const swayRotation = (Math.random() - 0.5) * 30; // G√≥c l·∫Øc l∆∞
        const swayOffset = (Math.random() - 0.5) * 20; // L·ªách ngang khi l·∫Øc l∆∞
        flowerEl.style.setProperty('--sway-duration', `${swayDuration}s`);
        flowerEl.style.setProperty('--sway-rotation', `${swayRotation}deg`);
        flowerEl.style.setProperty('--sway-offset', `${swayOffset}px`);

        flowerBorderContainer.appendChild(flowerEl);
        flowerElements.push(flowerEl);

        // X√≥a ph·∫ßn t·ª≠ sau khi animation k·∫øt th√∫c ƒë·ªÉ tr√°nh DOM b·ªã ƒë·∫ßy
        flowerEl.addEventListener('animationend', () => {
            flowerEl.remove();
            flowerElements = flowerElements.filter(el => el !== flowerEl);
        });
    }

    function showFlowerBorder() {
        flowerBorderContainer.style.display = 'block';
        if (!flowerInterval) {
            flowerInterval = setInterval(createFlowerPetal, 500); // T·∫°o hoa m·ªói 0.5 gi√¢y
        }
    }

    function hideFlowerBorder() {
        flowerBorderContainer.style.display = 'none';
        if (flowerInterval) {
            clearInterval(flowerInterval);
            flowerInterval = null;
        }
        removeFlowerPetals();
    }

    function removeFlowerPetals() {
        flowerElements.forEach(el => el.remove());
        flowerElements = [];
    }

    // =======================
    // Kh·ªüi t·∫°o khi t·∫£i trang
    // =======================
    document.addEventListener('DOMContentLoaded', () => {
        updateTexts();
        loadStartDate();
    });

</script>
</body>
</html>
